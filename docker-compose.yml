version: "3.9"

services:
  # ðŸ”¹ SQL SERVER
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: sqlserver
    restart: always
    environment:
      SA_PASSWORD: ${DB_PASSWORD}
      ACCEPT_EULA: "Y"
    ports:
      - "${DB_PORT}:1433"
    volumes:
      - sqlserver_data:/var/opt/mssql
    networks:
      - app-network

  # ðŸ”¹ BACKEND - NestJS
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: nest-backend
    restart: always
    depends_on:
      - db
    env_file: .env
    environment:
      DB_HOST: db
      DB_PORT: ${DB_PORT}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME}
      JWT_SECRET: ${BACKEND_JWT_SECRET}
    ports:
      - "${BACKEND_PORT}:3001"
    networks:
      - app-network

  # ðŸ”¹ FRONTEND - Next.js
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: next-frontend
    restart: always
    depends_on:
      - backend
    env_file: .env
    environment:
      NEXT_PUBLIC_API_URL: http://backend:3001
    ports:
      - "${FRONTEND_PORT}:3000"
    networks:
      - app-network

# ðŸ”¹ Volume persistente para banco
volumes:
  sqlserver_data:

# ðŸ”¹ Rede interna
networks:
  app-network:
    driver: bridge
